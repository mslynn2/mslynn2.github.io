<html>

<head>
    <meta charset=utf-8 />
    <title>GEO 509 Services Map</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />

    <script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>

    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />
    <link href='http://fonts.googleapis.com/css?family=Lato' rel='stylesheet' type='text/css'>

    <style>
        body {
            margin: 0;
            padding: 0;
            background: whitesmoke;
            font-family: Lato, sans-serif;
            color: #0D0000;
        }
        header {
            padding: 6px 10%;
        }
        h1 {
            position: absolute;
            z-index: 100;
            top: 10px;
            left: 60px;
            padding: 8px 15px;
            margin: 0;
            color: whitesmoke;
            font-size: 1.5em;
            background: rgba(25,25,25,0.8);
            border-radius: 5px; 
        }
        h2 {
            display: inline-block;
            color: #001323;
        }
        #map {
            position: absolute;
            width: 100%;
            top: 0;
            bottom: 0;
        }
        footer {
            padding: 6px 10%;
            width: 80%;
        }
        p {
            font-size: 1em;
            color: #001323;
        }
        /* Additional style rules go here! */
        
        .popup {
            background: green; 
            color: green;
        }
    </style>
</head>

<body>
    <header>
        <h1>GEO509</h1>
        <h2>Service Map</h2>
    </header>

    <div id='map'></div>

    <footer>
        <p>Map authored by Koenigsmark, Lynn, and Puckett</p>
        <p>An interactive map for identifying services in Northeast Lexington and Modal Attributes associated with each service.</p>
        <p>User Instructions: click on a location in the map boundary.  Then click on a service to discover the time and cost associated with traveling to that service on foot, via bicycle, or automobile. For areas outside the map boundary, click on a bus stop to see how long it might take to access this part of your journey. 
        </p>
    </footer>
    
    <script src = "services_3.js"></script>
    <script src = "Stops_2.js."></script>

    <script>
        var options = {
            center: [38.057849, -84.480684],
            zoom: 14,
            doubleClickZoom: false,
            dragging: false
        }
       
        var map = L.map('map', options);
        var tiles = L.tileLayer('http://{s}.{base}.maps.cit.api.here.com/maptile/2.1/maptile/{mapID}/normal.day.grey/{z}/{x}/{y}/256/png8?app_id={app_id}&app_code={app_code}', {
	attribution: 'Map &copy; 1987-2014 <a href="http://developer.here.com">HERE</a>',
	subdomains: '1234',
	mapID: 'newest',
	app_id: 'Y8m9dK2brESDPGJPdrvs',
	app_code: 'dq2MYIvjAotR8tHvY8Q_Dg',
	base: 'base',
	minZoom: 14,
	maxZoom: 14
});
//        var tiles = L.tileLayer('http://a{s}.acetate.geoiq.com/tiles/acetate-hillshading/{z}/{x}/{y}.png', {
//            attribution: '&copy;2012 Esri & Stamen, Data from OSM and Natural Earth',
//            subdomains: '0123',
//            minZoom: 14,
//            maxZoom: 14,            
//        });
        map.addLayer(tiles);
        
        // Begin writing your practice code here
        
        console.log(services);
        
        var hospital = L.geoJson(services, {
            pointToLayer: function(feature,latlng) {
                return L.circleMarker(latlng, {
                    color: '#1526F6',
                    weight: 4,
                    fillColor: '#1526F6',
                    fillOpacity: 0.5,
                    radius: 10
                });
            },
            filter: function(feature, layer) {
                if(feature.properties.service_type == "Hospital"){
                    return feature;
                }
            },
            onEachFeature: function(feature, layer) {
                var props = feature.properties;
                var content = "<b>" +props.service_name+ "</b></br>" +props.address;
                layer.bindPopup(content);
                layer.on('mouseover', function() {
                    layer.setStyle({
                        fillColor: 'yellow'
                    });
                });
                layer.on('mouseout', function() {
                    layer.setStyle({
                        fillColor: 'blue'
                    });
                });
            }                            
        }).addTo(map);
        
        var market = L.geoJson(services, {
            pointToLayer: function(feature,latlng) {
                return L.circleMarker(latlng, {
                    color: '#EEF501',
                    weight: 4,
                    fillColor: '#EEF501',
                    fillOpacity: 0.5,
                    radius: 10
                });
            },
            filter: function(feature, layer) {
                if(feature.properties.service_type == "Market"){
                    return feature;
                }
            },
            onEachFeature: function(feature, layer) {
                var props = feature.properties;
                var content = "<b>" +props.service_name+ "</b></br>" +props.address;
                layer.bindPopup(content);
                layer.on('mouseover', function() {
                    layer.setStyle({
                        fillColor: 'green'
                    });
                });
                layer.on('mouseout', function() {
                    layer.setStyle({
                        fillColor: '#EEF501'
                    });
                });
            }                            
        }).addTo(map);
        
        var pharmacy = L.geoJson(services, {
            pointToLayer: function(feature,latlng) {
                return L.circleMarker(latlng, {
                    color: '#FF0009',
                    weight: 4,
                    fillColor: '#FF0009',
                    fillOpacity: 0.5,
                    radius: 10
                });
            },
            filter: function(feature, layer) {
                if(feature.properties.service_type == "Pharmacy"){
                    return feature;
                }
            },
            onEachFeature: function(feature, layer) {
                var props = feature.properties;
                var content = "<b>" +props.service_name+ "</b></br>" +props.address;
                layer.bindPopup(content);
                layer.on('mouseover', function() {
                    layer.setStyle({
                        fillColor: 'yellow'
                    });
                });
                layer.on('mouseout', function() {
                    layer.setStyle({
                        fillColor: '#FF0009'
                    });
                });
            }                            
        }).addTo(map);
        
        var childcare = L.geoJson(services, {
            pointToLayer: function(feature,latlng) {
                return L.circleMarker(latlng, {
                    color: '#CD0351',
                    weight: 4,
                    fillColor: '#CD0351',
                    fillOpacity: 0.5,
                    radius: 10
                });
            },
            filter: function(feature, layer) {
                if(feature.properties.service_type == "Childcare"){
                    return feature;
                }
            },
            onEachFeature: function(feature, layer) {
                var props = feature.properties;
                var content = "<b>" +props.service_name+ "</b></br>" +props.address;
                layer.bindPopup(content);
                layer.on('mouseover', function() {
                    layer.setStyle({
                        fillColor: 'red'
                    });
                });
                layer.on('mouseout', function() {
                    layer.setStyle({
                        fillColor: '#CD0351'
                    });
                });
            }                            
        }).addTo(map);
        
        console.log(stops);
        
        var stops = L.geoJson(stops, {
            pointToLayer: function(feature,latlng) {
                return L.circleMarker(latlng, {
                    color: 'cyan',
                    weight: 4,
                    fillColor: 'cyan',
                    fillOpacity: 0.5,
                    radius: 5
                });
            },
            filter: function(feature, layer) {
                if(feature.geometry.type == "Point"){
                    return feature;
                }
            },
            onEachFeature: function(feature, layer) {
                var props = feature.properties;
                var content = "<b>" +props.Bus_Stop_ID+ "</b></br>" +props.Bus_Stop_Name;
                layer.bindPopup(content);
                layer.on('mouseover', function() {
                    layer.setStyle({
                        fillColor: 'blue'
                    });
                });
                layer.on('mouseout', function() {
                    layer.setStyle({
                        fillColor: 'cyan'
                    });
                });
            }                            
        }).addTo(map);
        
        map.on('click', function(e) {
            hospital.eachLayer(function(layer) {
                var distance = e.latlng.distanceTo(layer.getLatLng())/1000;  
                
                var hospitalName = layer.feature.properties.service_name;
                var hospitalAddress = layer.feature.properties.address;
                var content = "<b>"+hospitalName+"</b><br> "+hospitalAddress+" MW<br>"+
                      "I am <b>"+distance.toLocaleString()+ 
                               "km</b><br> from the click point."  
                layer.bindPopup(content);
                    
                });
        });
        
        map.on('click', function(e) {
            market.eachLayer(function(layer) {
                var distance = e.latlng.distanceTo(layer.getLatLng())/1000;  
                
                var marketName = layer.feature.properties.service_name;
                var marketAddress = layer.feature.properties.address;
                var content = "<b>"+marketName+"</b><br> "+marketAddress+" MW<br>"+
                      "I am <b>"+distance.toLocaleString()+ 
                               "km</b><br> from the click point."  
                layer.bindPopup(content);
                    
                });
        });
        
        map.on('click', function(e) {
            pharmacy.eachLayer(function(layer) {
                var distance = e.latlng.distanceTo(layer.getLatLng())/1000;  
                
                var pharmacyName = layer.feature.properties.service_name;
                var pharmacyAddress = layer.feature.properties.address;
                var content = "<b>"+pharmacyName+"</b><br> "+pharmacyAddress+" MW<br>"+
                      "I am <b>"+distance.toLocaleString()+ 
                               "km</b><br> from the click point."  
                layer.bindPopup(content);
                    
                });
        });
        
        map.on('click', function(e) {
            childcare.eachLayer(function(layer) {
                var distance = e.latlng.distanceTo(layer.getLatLng())/1000;  
                
                var childcareName = layer.feature.properties.service_name;
                var childcareAddress = layer.feature.properties.address;
                var content = "<b>"+childcareName+"</b><br> "+childcareAddress+" MW<br>"+
                      "I am <b>"+distance.toLocaleString()+ 
                               "km</b><br> from the click point."  
                layer.bindPopup(content);
                    
                });
        });
        
        map.on('click', function(e) {
            stops.eachLayer(function(layer) {
                var distance = e.latlng.distanceTo(layer.getLatLng())/1000;  
                
                var stopsName = layer.feature.properties.service_name;
                var stopsAddress = layer.feature.properties.address;
                var content = "<b>"+stopsName+"</b><br> "+stopsAddress+" MW<br>"+
                      "I am <b>"+distance.toLocaleString()+ 
                               "km</b><br> from the click point."  
                layer.bindPopup(content);
                    
                });
        });
        
        var sourcesLayers = {
        "<b style='color:#1526F6'>Hospitals</b>": hospital,
        "<b style='color:#FF5528'>Pharmacies</b>": pharmacy,
        "<b style='color:#EEF501'>Groceries</b>": market,
        "<b style='color:#34E247'>Childcare</b>": childcare,
        "<b style='color:cyan'>Bus Stops</b>": stops
        }

    L.control.layers(null, sourcesLayers, { collapsed:false }).addTo(map);
        
        var marker;
        
       // when the user clicks on the map
        map.on('click', function(e) { 
            // if the marker exists and is defined
            if(map.hasLayer(marker)) { 
               // remove it from the map
                map.removeLayer(marker);
            }
            
            // store the click coordinates in a variable
            var clickCoords = e.latlng; 
            
            // create a marker using those coods, 
            // add it to the map and assign it
            // to the existing variable marker
            marker = L.marker(clickCoords).addTo(map);
            
            // call the function and pass the marker's coords
            testDistance(clickCoords);
        
        });
        
        
        

    </script>
    
</body>

</html>